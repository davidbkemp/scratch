(function(e){var t=function(t,n){var r,i=function(){t=t||e.d3,n=n||e.d3MeasureText,r=t.svg.transform().translate(function(e){return[e.x,e.y]}).scale(function(e){return e.amplitude.magnitude()}).rotate(function(e){return-180*e.amplitude.phase()/Math.PI})},s=function(e){return i(),o(t.select(e))},o=function(e){function s(e,t){var n=t.length,r=t.lineClass,i=t.headClass;e.append("line").attr("class",r).attr("x1",0).attr("y1",0).attr("x2",n).attr("y2",0);var s=n/4,o=n-s,u=-s/2,a=o,f=u+s,l=n,c=0;e.append("polygon").attr("class",i).attr("points",""+o+","+u+" "+a+","+f+" "+l+","+c)}n.d3=n.d3||t;var i=n("M"),u=function(e,t,n){var i=e.enter().append("g").attr("class","animatedQubitsAmplitudeDisc").attr("transform",r);i.append("circle").attr("class","animatedQubitsAmplitudeCircle").attr("cx",0).attr("cy",0).attr("r",n.maxRadius),s(i,{length:n.maxRadius,lineClass:"animatedQubitsPhaseArrow",headClass:"animatedQubitsPhaseArrowEnd"})};return{getTextHeight:function(){return i.height},getTextWidth:function(){return i.width*1.5},setHeight:function(t){e.attr("height",t)},setWidth:function(t){e.attr("width",t)},addText:function(t){var n=t["class"],r=t.x||0,i=t.y||0,s=t.text;e.append("text").attr("x",r).attr("y",i).attr("class",n).text(s)},addTextWithSubscript:function(t,n,r,s){var o=e.append("g").append("text").attr("x",r);o.append("tspan").text(t).attr("y",s),o.append("tspan").text(n).attr("class","animatedTextSubscript").attr("y",s+i.height/2)},createGroup:function(n){var r=n["class"],i=n.x||0,s=n.y||0,u=t.svg.transform().translate([i,s]),a=e.append("g").attr("class",r).attr("transform",u);return o(a)},renderAmplitudeDiscs:function(t,n){var r=e.selectAll(".animatedQubitsAmplitudeDisc").data(t,function(e){return e.key});u(r,t,n),r.exit().remove()}}};return s};typeof define!="undefined"&&define.amd?define("qubitsGraphics",["d3","d3MeasureText"],t):typeof module!="undefined"&&module.exports?module.exports=t(require("d3"),require("d3-measure-text")):(e.animatedQubitsInternal=e.animatedQubitsInternal||{},e.animatedQubitsInternal.graphicsFactory=t())})(this),function(e){var t=function(t,n){var r,i=function(){t=t||e._,n=n||e.jsqubits,r=n.jsqubits},s=function(e){i();var n=e.maxRadius,s=function(e){return n*(e*Math.SQRT2+1)},o=function(e,n){var i=t.clone(e);return i.key=e.key+"-"+n,n>1&&(i.amplitude=r.ZERO),i},u=function(e,n){var r=t.clone(n);return r.amplitude=e.amplitude,r},a=function(e,t){var n={statesGroupedByOriginalState:[],phase1:[],phase2a:{},phase2b:{}};return e.forEach(function(e){var i=t(r(e.bitString)),s=[];n.statesGroupedByOriginalState.push(s);var a=1;i.each(function(){var t=o(e,a++),r=u(e,t),i=t.key;n.phase1.push(t),n.phase2a[i]=r,s.push(t)})}),n};return{yOffSetForState:s,augmentState:function(e){var t=0,n=[];return e.each(function(e){var r={bitString:e.asBitString(),numericIndex:e.asNumber(),amplitude:e.amplitude,key:"k"+ ++t,x:0,y:s(e.asNumber())};n.push(r)}),n.sort(function(e,t){return e.numericIndex-t.numericIndex}),n},createPhases:function(e,t){var n=a(e,t);return{phase1:n.phase1,phase2a:n.phase2a,phase2b:n.phase2b}}}};return s};typeof define!="undefined"&&define.amd?define("qubitAnimationCalculator",["lodash","jsqubits"],t):typeof module!="undefined"&&module.exports?module.exports=t(require("lodash"),require("jsqubits")):(e.animatedQubitsInternal=e.animatedQubitsInternal||{},e.animatedQubitsInternal.calculatorFactory=t())}(this),function(e){var t=function(t,n){var r=function(){t=t||e.animatedQubitsInternal.graphicsFactory,n=n||e.animatedQubitsInternal.calculatorFactory},i=function(e){r();var i=t(e.element),s=n(e),o=e.maxRadius,u=e.numBits,a=1<<u,f=i.getTextHeight(),l=i.getTextWidth(),c,h=function(){return s.yOffSetForState(a-1)+o},p=function(){return(1+u)*l+6*o},d=function(e){return("0000000000000000"+e.toString(2)).slice(-u)},v=function(e,t){var n=d(e);for(var r=0;r<u;r++)t.addText({"class":"animatedQubitsStateBitLabel",x:r*l,text:n.charAt(r)})};return{updateDimensions:function(){i.setHeight(h()),i.setWidth(p())},renderBitLabels:function(){var e=2*f/3;for(var t=0;t<u;t++){var n=(u-t-1).toString(),r=t*l;i.addTextWithSubscript("q",n,r,e)}},renderStateLabels:function(){for(var e=0;e<a;e++)v(e,i.createGroup({"class":"animatedQubitsStateLabel",y:s.yOffSetForState(e)+f/3}))},renderState:function(t){c=c||i.createGroup({"class":"animatedQubitsAmplitudeDiscs",x:o+(u+1)*l}),c.renderAmplitudeDiscs(t,e)}}};return i};typeof define!="undefined"&&define.amd?define("animatedQubitsRenderer",["qubitsGraphics","qubitAnimationCalculator"],t):typeof module!="undefined"&&module.exports?module.exports=t(require("./qubitsGraphics"),require("./qubitAnimationCalculator")):(e.animatedQubitsInternal=e.animatedQubitsInternal||{},e.animatedQubitsInternal.rendererFactory=t())}(this),function(e){var t=function(t,n,r){var i=function(){t=t||e.Q,n=n||e.animatedQubitsInternal.rendererFactory,r=r||e.animatedQubitsInternal.calculatorFactory};return function(e,s){i();var o,u=e.numBits(),a,f=r(s),l=t.when(),c=function(t){var n=f.createPhases(o,t),r=a.renderState(n.phase1);return e=t(e),o=f.augmentState(e),r};return{display:function(t){a=n({element:t,numBits:u,maxRadius:s.maxRadius}),a.updateDimensions(),a.renderBitLabels(),a.renderStateLabels(),o=f.augmentState(e),a.renderState(o)},applyOperation:function(e){return l=l.then(function(){return c(e)}),l}}}};typeof define!="undefined"&&define.amd?define("animatedQubits",["q","animatedQubitsRenderer","qubitAnimationCalculator"],t):typeof module!="undefined"&&module.exports?module.exports=t(require("q"),require("./lib/animatedQubitsRenderer"),require("./lib/qubitAnimationCalculator")):e.animatedQubits=t()}(this);